"use strict";var FraglateEval=function(){var fraglate=require("./index"),_=require("./util"),FraglateEval=function(t){this.fraglate=t};return FraglateEval.eval_with_context=function(code,context){return function(){return eval(code)}.call(context)},FraglateEval.eval_with_context_as_function=function(code,context){return function(){return eval("(function () { "+code+" }).bind(this)()")}.call(context)},FraglateEval.prototype.evalTranslate=function(t,e,r){if(_.isNil(t))return"";for(var a=/<([\s\S]+?)>|\\(?:<[\s\S]+?>)/g,n=0,l="";;){var i=a.exec(t);if(null==i){l+=t.substring(n,t.length);break}if(2!==i.length){console.error("trans array length !== 2. trans: ",i);break}l+=t.substring(n,i.index),n=i.index,l+=_.isNil(i[1])?i[0]:this.fraglate.translate(i[1],e,r),n+=i[0].length}return l},FraglateEval.prototype.evalInterpolate=function(t,e){if(_.isNil(t))return"";for(var r=/\{\{([\s\S]+?)\}\}/g,a=0,n="";;){var l=r.exec(t);if(null==l){n+=t.substring(a,t.length);break}if(2!==l.length){console.error("interpolate array length !== 2. interpolate: ",l);break}n+=t.substring(a,l.index),a=l.index,n+=_.isNil(l[1])?trans[0]:FraglateEval.eval_with_context(l[1],e),a+=l[0].length}return n},FraglateEval.prototype.evalInterpolateAsFunction=function(t,e){if(_.isNil(t))return"";for(var r=/\{\{\{([\s\S]+?)\}\}\}/g,a=0,n="";;){var l=r.exec(t);if(null==l){n+=t.substring(a,t.length);break}if(2!==l.length){console.error("interpolate array length !== 2. interpolate: ",l);break}n+=t.substring(a,l.index),a=l.index,n+=_.isNil(l[1])?trans[0]:FraglateEval.eval_with_context_as_function(l[1],e),a+=l[0].length}return n},FraglateEval.prototype.eval=function(t,e,r,a){_.isNil(a)&&(a={});var n=this.evalTranslate(t,e,r),l=this.evalInterpolateAsFunction(n,a),i=this.evalInterpolate(l,a);return i},FraglateEval}();module.exports=FraglateEval;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkZyYWdsYXRlRXZhbC5qcyJdLCJuYW1lcyI6WyJGcmFnbGF0ZUV2YWwiLCJmcmFnbGF0ZSIsInJlcXVpcmUiLCJfIiwidGhpcyIsImV2YWxfd2l0aF9jb250ZXh0IiwiY29kZSIsImNvbnRleHQiLCJldmFsIiwiY2FsbCIsImV2YWxfd2l0aF9jb250ZXh0X2FzX2Z1bmN0aW9uIiwicHJvdG90eXBlIiwiZXZhbFRyYW5zbGF0ZSIsInNlbnRlbmNlIiwibGFuZyIsInJlZ2lvbiIsImlzTmlsIiwidHJhbnNfcmUiLCJzZW50ZW5jZV9jdXJfaWR4IiwicmVzdWx0IiwidHJhbnMiLCJleGVjIiwic3Vic3RyaW5nIiwibGVuZ3RoIiwiY29uc29sZSIsImVycm9yIiwiaW5kZXgiLCJ0cmFuc2xhdGUiLCJldmFsSW50ZXJwb2xhdGUiLCJpbnRlcnBvbGF0ZV9yZSIsImludGVycG9sYXRlIiwiZXZhbEludGVycG9sYXRlQXNGdW5jdGlvbiIsInRyYW5zZWRfc2VudGVuY2UiLCJpbnRlcnBvbGF0ZWRfYXNfZnVuY3Rpb25fc2VudGVuY2UiLCJpbnRlcnBvbGF0ZWRfc2VudGVuY2UiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUVBLElBQUlBLGNBQWUsV0FDZixHQUFJQyxVQUFXQyxRQUFRLFdBQ25CQyxFQUFJRCxRQUFRLFVBRVpGLGFBQWUsU0FBU0MsR0FDeEJHLEtBQUtILFNBQVdBLEVBcUhwQixPQWxIQUQsY0FBYUssa0JBQW9CLFNBQVNDLEtBQU1DLFNBQzVDLE1BQU8sWUFDSCxNQUFPQyxNQUFLRixPQUNiRyxLQUFLRixVQUdaUCxhQUFhVSw4QkFBZ0MsU0FBU0osS0FBTUMsU0FDeEQsTUFBTyxZQUNILE1BQU9DLE1BQ0gsa0JBQW9CRixLQUFPLHFCQUVoQ0csS0FBS0YsVUFHWlAsYUFBYVcsVUFBVUMsY0FBZ0IsU0FBU0MsRUFBVUMsRUFBTUMsR0FDNUQsR0FBSVosRUFBRWEsTUFBTUgsR0FDUixNQUFPLEVBS1gsS0FIQSxHQUFJSSxHQUFXLGlDQUNYQyxFQUFtQixFQUNuQkMsRUFBUyxLQUNBLENBQ1QsR0FBSUMsR0FBUUgsRUFBU0ksS0FBS1IsRUFDMUIsSUFBYSxNQUFUTyxFQUFlLENBQ2ZELEdBQVVOLEVBQVNTLFVBQVVKLEVBQWtCTCxFQUFTVSxPQUN4RCxPQUVKLEdBQXFCLElBQWpCSCxFQUFNRyxPQUFjLENBQ3BCQyxRQUFRQyxNQUFNLG9DQUFxQ0wsRUFDbkQsT0FFSkQsR0FBVU4sRUFBU1MsVUFBVUosRUFBa0JFLEVBQU1NLE9BQ3JEUixFQUFtQkUsRUFBTU0sTUFJckJQLEdBSENoQixFQUFFYSxNQUFNSSxFQUFNLElBR0xBLEVBQU0sR0FGTmhCLEtBQUtILFNBQVMwQixVQUFVUCxFQUFNLEdBQUlOLEVBQU1DLEdBSXRERyxHQUFvQkUsRUFBTSxHQUFHRyxPQUVqQyxNQUFPSixJQUdYbkIsYUFBYVcsVUFBVWlCLGdCQUFrQixTQUFTZixFQUFVTixHQUN4RCxHQUFJSixFQUFFYSxNQUFNSCxHQUNSLE1BQU8sRUFLWCxLQUhBLEdBQUlnQixHQUFpQixzQkFDakJYLEVBQW1CLEVBQ25CQyxFQUFTLEtBQ0EsQ0FDVCxHQUFJVyxHQUFjRCxFQUFlUixLQUFLUixFQUN0QyxJQUFtQixNQUFmaUIsRUFBcUIsQ0FDckJYLEdBQVVOLEVBQVNTLFVBQVVKLEVBQWtCTCxFQUFTVSxPQUN4RCxPQUVKLEdBQTJCLElBQXZCTyxFQUFZUCxPQUFjLENBQzFCQyxRQUFRQyxNQUFNLGdEQUNWSyxFQUNKLE9BRUpYLEdBQVVOLEVBQVNTLFVBQVVKLEVBQWtCWSxFQUFZSixPQUMzRFIsRUFBbUJZLEVBQVlKLE1BSzNCUCxHQUpDaEIsRUFBRWEsTUFBTWMsRUFBWSxJQUlYVixNQUFNLEdBSE5wQixhQUFhSyxrQkFBa0J5QixFQUFZLEdBQ2pEdkIsR0FJUlcsR0FBb0JZLEVBQVksR0FBR1AsT0FFdkMsTUFBT0osSUFHWG5CLGFBQWFXLFVBQVVvQiwwQkFBNEIsU0FBU2xCLEVBQVVOLEdBQ2xFLEdBQUlKLEVBQUVhLE1BQU1ILEdBQ1IsTUFBTyxFQUtYLEtBSEEsR0FBSWdCLEdBQWlCLDBCQUNqQlgsRUFBbUIsRUFDbkJDLEVBQVMsS0FDQSxDQUNULEdBQUlXLEdBQWNELEVBQWVSLEtBQUtSLEVBQ3RDLElBQW1CLE1BQWZpQixFQUFxQixDQUNyQlgsR0FBVU4sRUFBU1MsVUFBVUosRUFBa0JMLEVBQVNVLE9BQ3hELE9BRUosR0FBMkIsSUFBdkJPLEVBQVlQLE9BQWMsQ0FDMUJDLFFBQVFDLE1BQU0sZ0RBQWlESyxFQUMvRCxPQUVKWCxHQUFVTixFQUFTUyxVQUFVSixFQUFrQlksRUFBWUosT0FDM0RSLEVBQW1CWSxFQUFZSixNQUkzQlAsR0FIQ2hCLEVBQUVhLE1BQU1jLEVBQVksSUFHWFYsTUFBTSxHQUZOcEIsYUFBYVUsOEJBQThCb0IsRUFBWSxHQUFJdkIsR0FJekVXLEdBQW9CWSxFQUFZLEdBQUdQLE9BRXZDLE1BQU9KLElBR1huQixhQUFhVyxVQUFVSCxLQUFPLFNBQVNLLEVBQVVDLEVBQU1DLEVBQVFSLEdBQ3ZESixFQUFFYSxNQUFNVCxLQUNSQSxLQUVKLElBQUl5QixHQUFtQjVCLEtBQUtRLGNBQWNDLEVBQVVDLEVBQU1DLEdBQ3REa0IsRUFBb0M3QixLQUFLMkIsMEJBQTBCQyxFQUFrQnpCLEdBQ3JGMkIsRUFBd0I5QixLQUFLd0IsZ0JBQWdCSyxFQUFtQzFCLEVBRXBGLE9BQU8yQixJQUdKbEMsZUFHWG1DLFFBQU9DLFFBQVVwQyIsImZpbGUiOiJGcmFnbGF0ZUV2YWwuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbnZhciBGcmFnbGF0ZUV2YWwgPSAoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGZyYWdsYXRlID0gcmVxdWlyZSgnLi9pbmRleCcpO1xuICAgIHZhciBfID0gcmVxdWlyZSgnLi91dGlsJyk7XG5cbiAgICB2YXIgRnJhZ2xhdGVFdmFsID0gZnVuY3Rpb24oZnJhZ2xhdGUpIHtcbiAgICAgICAgdGhpcy5mcmFnbGF0ZSA9IGZyYWdsYXRlO1xuICAgIH1cblxuICAgIEZyYWdsYXRlRXZhbC5ldmFsX3dpdGhfY29udGV4dCA9IGZ1bmN0aW9uKGNvZGUsIGNvbnRleHQpIHtcbiAgICAgICAgcmV0dXJuIChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBldmFsKGNvZGUpO1xuICAgICAgICB9KS5jYWxsKGNvbnRleHQpO1xuICAgIH07XG5cbiAgICBGcmFnbGF0ZUV2YWwuZXZhbF93aXRoX2NvbnRleHRfYXNfZnVuY3Rpb24gPSBmdW5jdGlvbihjb2RlLCBjb250ZXh0KSB7XG4gICAgICAgIHJldHVybiAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gZXZhbChcbiAgICAgICAgICAgICAgICAnKGZ1bmN0aW9uICgpIHsgJyArIGNvZGUgKyAnIH0pLmJpbmQodGhpcykoKSdcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0pLmNhbGwoY29udGV4dCk7XG4gICAgfTtcblxuICAgIEZyYWdsYXRlRXZhbC5wcm90b3R5cGUuZXZhbFRyYW5zbGF0ZSA9IGZ1bmN0aW9uKHNlbnRlbmNlLCBsYW5nLCByZWdpb24pIHtcbiAgICAgICAgaWYgKF8uaXNOaWwoc2VudGVuY2UpKSB7XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRyYW5zX3JlID0gLzwoW1xcc1xcU10rPyk+fFxcXFwoPzo8W1xcc1xcU10rPz4pL2c7XG4gICAgICAgIHZhciBzZW50ZW5jZV9jdXJfaWR4ID0gMDtcbiAgICAgICAgdmFyIHJlc3VsdCA9ICcnO1xuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgdmFyIHRyYW5zID0gdHJhbnNfcmUuZXhlYyhzZW50ZW5jZSk7XG4gICAgICAgICAgICBpZiAodHJhbnMgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBzZW50ZW5jZS5zdWJzdHJpbmcoc2VudGVuY2VfY3VyX2lkeCwgc2VudGVuY2UubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0cmFucy5sZW5ndGggIT09IDIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCd0cmFucyBhcnJheSBsZW5ndGggIT09IDIuIHRyYW5zOiAnLCB0cmFucyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXN1bHQgKz0gc2VudGVuY2Uuc3Vic3RyaW5nKHNlbnRlbmNlX2N1cl9pZHgsIHRyYW5zLmluZGV4KTtcbiAgICAgICAgICAgIHNlbnRlbmNlX2N1cl9pZHggPSB0cmFucy5pbmRleDtcbiAgICAgICAgICAgIGlmICghXy5pc05pbCh0cmFuc1sxXSkpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gdGhpcy5mcmFnbGF0ZS50cmFuc2xhdGUodHJhbnNbMV0sIGxhbmcsIHJlZ2lvbik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdCArPSB0cmFuc1swXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlbnRlbmNlX2N1cl9pZHggKz0gdHJhbnNbMF0ubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcblxuICAgIEZyYWdsYXRlRXZhbC5wcm90b3R5cGUuZXZhbEludGVycG9sYXRlID0gZnVuY3Rpb24oc2VudGVuY2UsIGNvbnRleHQpIHtcbiAgICAgICAgaWYgKF8uaXNOaWwoc2VudGVuY2UpKSB7XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGludGVycG9sYXRlX3JlID0gL1xce1xceyhbXFxzXFxTXSs/KVxcfVxcfS9nO1xuICAgICAgICB2YXIgc2VudGVuY2VfY3VyX2lkeCA9IDA7XG4gICAgICAgIHZhciByZXN1bHQgPSAnJztcbiAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgIHZhciBpbnRlcnBvbGF0ZSA9IGludGVycG9sYXRlX3JlLmV4ZWMoc2VudGVuY2UpO1xuICAgICAgICAgICAgaWYgKGludGVycG9sYXRlID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gc2VudGVuY2Uuc3Vic3RyaW5nKHNlbnRlbmNlX2N1cl9pZHgsIHNlbnRlbmNlLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaW50ZXJwb2xhdGUubGVuZ3RoICE9PSAyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignaW50ZXJwb2xhdGUgYXJyYXkgbGVuZ3RoICE9PSAyLiBpbnRlcnBvbGF0ZTogJyxcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJwb2xhdGUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzdWx0ICs9IHNlbnRlbmNlLnN1YnN0cmluZyhzZW50ZW5jZV9jdXJfaWR4LCBpbnRlcnBvbGF0ZS5pbmRleCk7XG4gICAgICAgICAgICBzZW50ZW5jZV9jdXJfaWR4ID0gaW50ZXJwb2xhdGUuaW5kZXg7XG4gICAgICAgICAgICBpZiAoIV8uaXNOaWwoaW50ZXJwb2xhdGVbMV0pKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IEZyYWdsYXRlRXZhbC5ldmFsX3dpdGhfY29udGV4dChpbnRlcnBvbGF0ZVsxXSxcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdCArPSB0cmFuc1swXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlbnRlbmNlX2N1cl9pZHggKz0gaW50ZXJwb2xhdGVbMF0ubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcblxuICAgIEZyYWdsYXRlRXZhbC5wcm90b3R5cGUuZXZhbEludGVycG9sYXRlQXNGdW5jdGlvbiA9IGZ1bmN0aW9uKHNlbnRlbmNlLCBjb250ZXh0KSB7XG4gICAgICAgIGlmIChfLmlzTmlsKHNlbnRlbmNlKSkge1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9XG4gICAgICAgIHZhciBpbnRlcnBvbGF0ZV9yZSA9IC9cXHtcXHtcXHsoW1xcc1xcU10rPylcXH1cXH1cXH0vZztcbiAgICAgICAgdmFyIHNlbnRlbmNlX2N1cl9pZHggPSAwO1xuICAgICAgICB2YXIgcmVzdWx0ID0gJyc7XG4gICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICB2YXIgaW50ZXJwb2xhdGUgPSBpbnRlcnBvbGF0ZV9yZS5leGVjKHNlbnRlbmNlKTtcbiAgICAgICAgICAgIGlmIChpbnRlcnBvbGF0ZSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IHNlbnRlbmNlLnN1YnN0cmluZyhzZW50ZW5jZV9jdXJfaWR4LCBzZW50ZW5jZS5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGludGVycG9sYXRlLmxlbmd0aCAhPT0gMikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2ludGVycG9sYXRlIGFycmF5IGxlbmd0aCAhPT0gMi4gaW50ZXJwb2xhdGU6ICcsIGludGVycG9sYXRlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc3VsdCArPSBzZW50ZW5jZS5zdWJzdHJpbmcoc2VudGVuY2VfY3VyX2lkeCwgaW50ZXJwb2xhdGUuaW5kZXgpO1xuICAgICAgICAgICAgc2VudGVuY2VfY3VyX2lkeCA9IGludGVycG9sYXRlLmluZGV4O1xuICAgICAgICAgICAgaWYgKCFfLmlzTmlsKGludGVycG9sYXRlWzFdKSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBGcmFnbGF0ZUV2YWwuZXZhbF93aXRoX2NvbnRleHRfYXNfZnVuY3Rpb24oaW50ZXJwb2xhdGVbMV0sIGNvbnRleHQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gdHJhbnNbMF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZW50ZW5jZV9jdXJfaWR4ICs9IGludGVycG9sYXRlWzBdLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG5cbiAgICBGcmFnbGF0ZUV2YWwucHJvdG90eXBlLmV2YWwgPSBmdW5jdGlvbihzZW50ZW5jZSwgbGFuZywgcmVnaW9uLCBjb250ZXh0KSB7XG4gICAgICAgIGlmIChfLmlzTmlsKGNvbnRleHQpKSB7XG4gICAgICAgICAgICBjb250ZXh0ID0ge307XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRyYW5zZWRfc2VudGVuY2UgPSB0aGlzLmV2YWxUcmFuc2xhdGUoc2VudGVuY2UsIGxhbmcsIHJlZ2lvbik7XG4gICAgICAgIHZhciBpbnRlcnBvbGF0ZWRfYXNfZnVuY3Rpb25fc2VudGVuY2UgPSB0aGlzLmV2YWxJbnRlcnBvbGF0ZUFzRnVuY3Rpb24odHJhbnNlZF9zZW50ZW5jZSwgY29udGV4dCk7XG4gICAgICAgIHZhciBpbnRlcnBvbGF0ZWRfc2VudGVuY2UgPSB0aGlzLmV2YWxJbnRlcnBvbGF0ZShpbnRlcnBvbGF0ZWRfYXNfZnVuY3Rpb25fc2VudGVuY2UsIGNvbnRleHQpO1xuXG4gICAgICAgIHJldHVybiBpbnRlcnBvbGF0ZWRfc2VudGVuY2U7XG4gICAgfTtcblxuICAgIHJldHVybiBGcmFnbGF0ZUV2YWw7XG59KSgpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEZyYWdsYXRlRXZhbDsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
